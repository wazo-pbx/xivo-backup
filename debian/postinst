#! /bin/sh
# postinst script for xivo-backup
#
# see: dh_installdeb(1)

set -e

old_bck_path="/var/backups/pf-xivo"
old_logrotate_file="/etc/logrotate.d/pf-xivo-backup"

bck_path="/var/backups/xivo"
xivo_files="$bck_path/data.tgz"
db_file="$bck_path/db.tgz"
consul_file="$bck_path/consul-kv.json"

case "$1" in
    configure)
        if [ -d "$old_bck_path" ];
        then
            find $old_bck_path -type f -exec mv {} $bck_path \;
            rm -rf "$old_bck_path"
        fi

        if [ -f "$old_logrotate_file" ];
        then
            rm "$old_logrotate_file"
        fi

        for file in $xivo_files $db_file $consul_file; do
            if [ ! -f "$file" ];
            then
                touch -d 19700101 "$file"
                chmod 640 "$file"
                chown root:www-data "$file"
            fi
        done
    ;;
    abort-upgrade|abort-remove|abort-deconfigure)

    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
